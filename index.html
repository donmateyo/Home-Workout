<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Progressive Workout App</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Progressive Workout">
    <meta name="apple-mobile-web-app-title" content="Progressive Workout">
    <meta name="description" content="High-intensity bodyweight workout app with progressive difficulty">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#00FF00">
    <meta name="background-color" content="#000000">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiBmaWxsPSIjMDAwMDAwIiByeD0iMzYiLz4KPHN2ZyB4PSI0NSIgeT0iNDUiIHdpZHRoPSI5MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMTIgMkw0IDEyTDEyIDIyTDIwIDEyTDEyIDJaIiBmaWxsPSIjMDBGRjAwIiBzdHJva2U9IiMwMEZGMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8cGF0aCBkPSJNOCAxMkwxMiA4TDE2IDEyTDEyIDE2TDggMTJaIiBmaWxsPSIjMDAwMDAwIi8+Cjx0ZXh0IHg9IjkwIiB5PSIxNTUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiMwMEZGMDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfkqo8L3RleHQ+Cjwvc3ZnPgo8L3N2Zz4K">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMNDEyTDEyIDIyTDIwIDEyTDEyIDJaIiBmaWxsPSIjMDBGRjAwIiBzdHJva2U9IiMwMEZGMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8cGF0aCBkPSJNOCAxMkwxMiA4TDE2IDEyTDEyIDE2TDggMTJaIiBmaWxsPSIjMDAwMDAwIi8+Cjwvc3ZnPgo=">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIlByb2dyZXNzaXZlIFdvcmtvdXQgQXBwIiwKICAic2hvcnRfbmFtZSI6ICJQcm9ncmVzc2l2ZSBXb3Jrb3V0IiwKICAiZGVzY3JpcHRpb24iOiAiSGlnaC1pbnRlbnNpdHkgYm9keXdlaWdodCB3b3Jrb3V0IGFwcCB3aXRoIHByb2dyZXNzaXZlIGRpZmZpY3VsdHkiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzAwMDAwMCIsCiAgInRoZW1lX2NvbG9yIjogIiMwMEZGMDAiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5EZ2lJR2hsYVdkb2REMGlORGdpSUhacFpYZENiM2c5SWpBZ01DQXlOQ0F5TkNJZ1ptbHNiRDBpYm05dVpTSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNEtQSEJoZEdnZ1pEMGlUVEV5SURKTU5ERXlURXhNTVRJZ01qSk1NakFnTVRKTU1USTJTQ0lnWm1sc2JEMGlJekF3UmtZd01DSWdjM1J5YjJ0bFBTSWpNREJHUmpBd0lpQnpkSEp2YTJVdGQybGtkR2c5SWpJaUlITjBjbTlyWlMxc2FXNWxhbTlwYmowaWNtOTFibVFpTHo0S1BIQmhkR2dnWkQwaVRUZ2dNVEpNTVRJZ09FeE1OVFLNE1RTTU1URVlUREV5SURFMlREZ2dNVEphSWlCbWFXeHNQU0lqTURBd01EQXdJaTgrQ2p3dmMzWm5QZ289IiwKICAgICAgInNpemVzIjogIjQ4eDQ4IiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpT1RZaUlHaGxhV2RvZEQwaU9UWWlJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXlOQ0lnWm1sc2JEMGlibTl1WlNJZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWo0S1BIQmhkR2dnWkQwaVRURXlJREpNTkVFeU1VTDFNVEV5SURJeVRESXdJREV5VERYTU1USTJTQ0lnWm1sc2JEMGlJekF3UmtZd01DSWdjM1J5YjJ0bFBTSWpNREJHUmpBd0lpQnpkSEp2YTJVdGQybGtkR2c5SWpJaUlITjBjbTlyWlMxc2FXNWxhbTlwYmowaWNtOTFibVFpTHo0S1BIQmhkR2dnWkQwaVRUZ2dNVEpNTVRJZ09FeE1OVDJTREV5SURFMlREZ2dNVEphSWlCbWFXeHNQU0lqTURBd01EQXdJaTgrQ2p3dmMzWm5QZ289IiwKICAgICAgInNpemVzIjogIjk2eDk2IiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRneElpQm9aV2xuYUhROUlURTRNU0lnZG1sbGQwSnZlRDBpTUNBd0lERTRNQ0F4T0RBaUlHWnBiR3c5SW01dmJtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStDbkpsWTNRZ2QybGtkR2c5SWpFNE1DSWdhR1ZwWjJoMFBTSXhPREFpSUdacGJHdzlJaU13TURBd01EQWlJSEo0UFNJek5pSXZQZ284YzNabklIZzlJalExSWlCNVBTSTBOU0lnZDJsa2RHZzlJamt3SWlCb1pXbG5hSFE5SWprd0lpQjJhV1YzUW05NFBTSXdJREFnTWpRZ01qUWlJR1pwYkd3OUltNXZibVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrQ25CaGRHZ2daRDBpVFRFeUlESk1OREFnTVRKTU1USWdNakpNTWpBZ01UWk1NVElnTWtrYVptbHNiRDBpSXpBd1JrWXdNQ0lnYzNSeWIydGxQU0lqTURCR1JqQXdJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqSWlJSE4wY205clpTMXNhVzVsYW05cGJqMGljbTkxYm1RaUx6NEtQSEJoZEdnZ1pEMGlUVGdnTVRKTU1USTFPRXRNVFRFEK1NUkEyVEdnd01EUWFQU0lnWm1sc2JEMGlJekF3TURBd01DSTZkMFp0TG5obVpYaDBJSGc5SWprd0lpQjVQU0l4TlRVaUlHWnZiblF0Wm1GdGFXeDVQU0pCY21saGJDd2djMkZ1Y3kxelpYSnBaaUlnWm05dWRDMXphWHBsUFNJeU5DSWdabTl1ZEMxM1pXbG5hSFE5SW1KdmJHUWlJR1pwYkd3OUlpTXdNRVpHTURBaUlIUmxlSFF0WVc1amFHOXlQU0p0YVdSa2JHVWlQbkFnMXo4NGNtdXNSR3hOVnk4UQ==IiwKICAgICAgInNpemVzIjogIjE4MHgxODAiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlOVEV5SWlCb1pXbG5hSFE5SWpVeE1pSWdkbWxsZDBKdmVEMGlNQ0F3SURRNU1pQTBPVElpSUdacGJHdzlJbTV2Ym1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0NuSmxZM1FnZDJsa2RHZzlJalV4TWlJZ2FHVnBaMmgwUFNJMU1USWlJR1pwYkd3OUlpTXdNREF3TUVBaUlISjRQU0kzTWlJdlBnbzhjM1puSUhnOUlqRXlPQ0lnZVQwaU1UTTFJaUIzYVdSMGFEMGlNalUySWlCb1pXbG5hSFE5SWpJMU5pSWdkbWxsZDBKdmVEMGlNQ0F3SURRNE5DQTBPRFFpSUdacGJHdzlJbTV2Ym1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0NuQmhkR2dnWkQwaVRUSTBOQ0F4TVVZNE5DQXlOREJ6TXpJZ01qTXpMakV5SURFeElERXpNeUl0TFMxaE1UZG1JVGdnTFRZNE1DMHhNVE11TlRrZ01ESTJMVE14TXk0MU9TQTJOR009IUdacGJHdzlJaU13TUVaR01EQWlJSE4wY205clpUMGlJekF3UmtZd01DSWdjM1J5YjJ0bExYZHBaSFJvUFNJMElpQnpkSEp2YTJVdGJHbHVaV3B2YVc0OUluSnZkVzVrSWk4K0NqeHdZWFJvSUdROUlrMHlNRGdnTWpRd01EQTFORF0NU1RBZ1pWRWdlU0F6TWtZeElGUk4yWUFySFJhZ2h5UStjaE9VWUVOSEIwMlVIcG1hV3hzUFNJak1EQkdSakF3SWk4k0NueDJaWGgwSUhnOUlqSTFOaUlnZVQwaU5UUXdJaUJtYjI1MExXWmhiV2xzZVQwaVFYSnBZV3dzSUhOaGJuTXRjMlZ5YVdZaUlHWnZiblF0YzJsNlpUMGlOamFpSUdadmJuUXRkMlZwWjJoMFBTSmliMnhrSWlCbWFXeHNQU0lqTURCR1JqQXdJaUIwWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsSWo1UGNtY3JMejQzWGpOVk1qaz0iLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXSwKICAiY2F0ZWdvcmllcyI6IFsiZml0bmVzcyIsICJoZWFsdGgiLCAic3BvcnRzIl0sCiAgImxhbmciOiAiZW4iLAogICJkaXIiOiAibHRyIgp9">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
        }
        
        body.dark {
            background: linear-gradient(135deg, #000000 0%, #0a0a0a 50%, #1a1a1a 100%);
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .video-placeholder {
            position: relative;
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0.5rem 0;
        }
        
        .play-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 0, 0, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.5rem;
            transition: transform 0.3s;
        }
        
        .play-btn:hover {
            transform: scale(1.1);
        }
        
        .timer-display {
            font-family: 'Inter', sans-serif;
            font-weight: 800;
            color: #00FF00;
            text-shadow: 0 0 30px rgba(0, 255, 0, 0.5), 0 0 60px rgba(0, 255, 0, 0.3);
            filter: drop-shadow(0 0 10px rgba(0, 255, 0, 0.4));
        }
        
        .rep-counter {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            color: #00FF00;
        }
        
        .glass-card {
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid rgba(0, 255, 0, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 255, 0, 0.1);
            will-change: transform;
        }
        
        .dark .glass-card {
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(0, 255, 0, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), 0 0 30px rgba(0, 255, 0, 0.15);
        }
        
        .exercise-card {
            background: rgba(15, 15, 15, 0.95);
            border: 1px solid rgba(0, 255, 0, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6), 0 0 15px rgba(0, 255, 0, 0.1);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            position: relative;
            overflow: hidden;
            will-change: transform;
        }
        
        .dark .exercise-card {
            background: rgba(5, 5, 5, 0.95);
            border: 1px solid rgba(0, 255, 0, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.9), 0 0 20px rgba(0, 255, 0, 0.15);
        }
        
        .exercise-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .exercise-card:hover::before {
            left: 100%;
        }
        
        .exercise-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 255, 0, 0.3), 0 0 40px rgba(0, 255, 0, 0.2);
        }
        
        .exercise-active {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.15), rgba(0, 200, 0, 0.1));
            border: 2px solid #00FF00;
            box-shadow: 0 0 0 4px rgba(0, 255, 0, 0.3), 0 16px 64px rgba(0, 255, 0, 0.4), 0 0 20px rgba(0, 255, 0, 0.5);
            animation: neon-pulse-glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes neon-pulse-glow {
            from {
                box-shadow: 0 0 0 4px rgba(0, 255, 0, 0.3), 0 16px 64px rgba(0, 255, 0, 0.4), 0 0 20px rgba(0, 255, 0, 0.5);
            }
            to {
                box-shadow: 0 0 0 8px rgba(0, 255, 0, 0.5), 0 20px 80px rgba(0, 255, 0, 0.6), 0 0 40px rgba(0, 255, 0, 0.8);
            }
        }
        
        .exercise-completed {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.15), rgba(0, 200, 0, 0.1));
            border: 2px solid #00FF00;
            box-shadow: 0 0 0 4px rgba(0, 255, 0, 0.2), 0 16px 40px rgba(0, 255, 0, 0.3), 0 0 15px rgba(0, 255, 0, 0.4);
        }
        
        .exercise-completed::after {
            content: '‚úì';
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #00FF00, #00CC00);
            color: #000000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 16px rgba(0, 255, 0, 0.5), 0 0 10px rgba(0, 255, 0, 0.7);
        }
        
        .rest-mode {
            background: linear-gradient(135deg, rgba(255, 255, 0, 0.15), rgba(255, 200, 0, 0.1));
            border: 2px solid #FFFF00;
            box-shadow: 0 0 0 4px rgba(255, 255, 0, 0.2), 0 16px 40px rgba(255, 255, 0, 0.3), 0 0 15px rgba(255, 255, 0, 0.4);
            animation: rest-pulse 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes rest-pulse {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #00FF00, #00CC00);
            box-shadow: 0 8px 32px rgba(0, 255, 0, 0.4), 0 0 20px rgba(0, 255, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .btn-gradient:hover::before {
            left: 100%;
        }
        
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(0, 255, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.5);
        }
        
        .btn-glass {
            background: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #00FF00;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 15px rgba(0, 255, 0, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .dark .btn-glass {
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(0, 255, 0, 0.4);
        }
        
        .btn-glass:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(0, 255, 0, 0.4), 0 0 25px rgba(0, 255, 0, 0.3);
            background: rgba(0, 255, 0, 0.1);
        }
        
        .nav-tab {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #00FF00, #00CC00);
            color: #000000;
            box-shadow: 0 4px 20px rgba(0, 255, 0, 0.4), 0 0 15px rgba(0, 255, 0, 0.3);
        }
        
        .nav-tab:not(.active):hover {
            background: rgba(0, 255, 0, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
        }
        
        .header-gradient {
            background: linear-gradient(135deg, #000000, #1a1a1a);
            border-bottom: 2px solid #00FF00;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #00FF00, #00CC00);
            box-shadow: 0 2px 10px rgba(0, 255, 0, 0.5), 0 0 15px rgba(0, 255, 0, 0.3);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .main-timer {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(0, 255, 0, 0.3);
            box-shadow: 0 16px 64px rgba(0, 0, 0, 0.8), 0 0 30px rgba(0, 255, 0, 0.2);
        }
        
        .dark .main-timer {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(0, 255, 0, 0.4);
            box-shadow: 0 16px 64px rgba(0, 0, 0, 0.9), 0 0 40px rgba(0, 255, 0, 0.3);
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .shimmer {
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.5) 50%, transparent 70%);
            background-size: 200% 200%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% -200%; }
            100% { background-position: 200% 200%; }
        }
        
        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        
        .modal-backdrop {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }
        
        .week-selector {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .stats-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* PWA and Mobile Optimization */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        button, input, select, textarea {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Prevent zoom on double tap for all buttons */
        button {
            touch-action: manipulation;
            -ms-touch-action: manipulation;
        }
        
        /* Specifically target the rep counter button to prevent zoom */
        #repPlus {
            touch-action: manipulation;
            -ms-touch-action: manipulation;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        /* Prevent text selection on rapid tapping */
        .rep-counter, #repCount, #repModal * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Prevent double-tap zoom on entire modal */
        #repModal {
            touch-action: manipulation;
            -ms-touch-action: manipulation;
        }
        
        /* PWA safe area handling */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
            
            .header-gradient {
                padding-top: max(1rem, env(safe-area-inset-top));
            }
        }
        
        /* Prevent overscroll bounce on iOS */
        body {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Optimize for fullscreen PWA experience */
        @media (display-mode: standalone) {
            body {
                background-attachment: fixed;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#00FF00',
                        'primary-dark': '#00CC00',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white font-sans">
    <!-- Header -->
    <header class="header-gradient text-white p-4 sticky top-0 z-40">
        <div class="max-w-6xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
            <h1 class="text-3xl font-bold floating-animation">üí™ Progressive Workout</h1>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <span class="text-sm font-medium">Week:</span>
                    <select id="weekSelector" class="week-selector text-white rounded-lg px-3 py-2 text-base font-medium">
                        <option value="1">1 (45s/15s)</option>
                        <option value="2">2 (50s/10s)</option>
                        <option value="3">3 (55s/5s)</option>
                        <option value="4">4 (60s/0s)</option>
                    </select>
                </div>
                <div id="globalTimer" class="bg-white bg-opacity-20 rounded-lg px-4 py-2 text-lg font-bold backdrop-blur-sm text-white">
                    00:00
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto p-4">
        <!-- Week Progression Info -->
        <div class="glass-card rounded-xl p-6 mb-8 shimmer">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-primary mb-3">üöÄ Weekly Progression</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center p-2 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Week 1:</span>
                            <span class="text-sm">45s work / 15s rest - Learn form</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Week 2:</span>
                            <span class="text-sm">50s work / 10s rest - +5-10% reps</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Week 3:</span>
                            <span class="text-sm">55s work / 5s rest - +5-10% reps</span>
                        </div>
                        <div class="flex justify-between items-center p-2 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Week 4:</span>
                            <span class="text-sm">60s work / 0s rest - +5-10% reps</span>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-primary mb-3">üìä Current Session</h3>
                    <div class="space-y-3" id="sessionInfo">
                        <div class="flex justify-between items-center p-3 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Phase:</span>
                            <span id="currentPhase" class="font-bold text-primary">Ready to Start</span>
                        </div>
                        <div id="roundInfo" class="hidden flex justify-between items-center p-3 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Round:</span>
                            <span id="currentRound" class="font-bold text-primary">0</span>/3
                        </div>
                        <div class="flex justify-between items-center p-3 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Total Reps:</span>
                            <span id="totalReps" class="font-bold text-2xl text-primary">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 rounded-lg bg-gradient-to-r from-green-900/20 to-green-800/30 border border-green-500/20">
                            <span class="font-medium">Target:</span>
                            <span id="targetReps" class="font-bold text-gray-300 dark:text-gray-300">Beat last week!</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex overflow-x-auto space-x-1 mb-8 glass-card rounded-xl p-2">
            <button class="nav-tab active bg-primary text-white px-3 py-2 rounded-lg font-medium transition-colors whitespace-nowrap text-xs sm:text-sm sm:px-4 sm:py-3" data-section="warmup">
                üî• Warmup
            </button>
            <button class="nav-tab px-3 py-2 rounded-lg font-medium transition-colors whitespace-nowrap text-xs sm:text-sm sm:px-4 sm:py-3" data-section="circuit">
                üí™ Circuit
            </button>
            <button class="nav-tab px-3 py-2 rounded-lg font-medium transition-colors whitespace-nowrap text-xs sm:text-sm sm:px-4 sm:py-3" data-section="finisher">
                ‚ö° Finisher
            </button>
            <button class="nav-tab px-3 py-2 rounded-lg font-medium transition-colors whitespace-nowrap text-xs sm:text-sm sm:px-4 sm:py-3" data-section="cooldown">
                üßò Cool-down
            </button>
        </div>

        <!-- Timer Control Panel -->
        <div class="main-timer rounded-2xl p-8 mb-8 text-center">
            <div class="timer-display text-8xl mb-6 floating-animation" id="mainTimer">00:00</div>
            <div class="text-2xl mb-8 font-semibold" id="timerStatus">Ready to Start</div>
            <div class="flex flex-wrap justify-center gap-4">
                <button id="startBtn" class="btn-gradient text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform transition-all duration-300">
                    üöÄ Start Workout
                </button>
                <button id="pauseBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform transition-all duration-300 hidden">
                    ‚è∏Ô∏è Pause
                </button>
                <button id="skipBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform transition-all duration-300 hidden">
                    ‚è≠Ô∏è Skip Exercise
                </button>
                <button id="completeBtn" class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform transition-all duration-300 hidden">
                    ‚úÖ Complete Workout
                </button>
                <button id="resetBtn" class="btn-glass px-8 py-4 rounded-xl font-bold text-lg shadow-lg transform transition-all duration-300">
                    üîÑ Reset Timer
                </button>
            </div>
        </div>

        <!-- Warmup Section -->
        <section id="warmup-section" class="workout-section">
            <h2 class="text-2xl font-bold mb-4 text-primary">Dynamic Warmup (3 minutes)</h2>
            <p class="mb-4 text-gray-600 dark:text-gray-400">30 seconds each exercise, no rest between</p>
            <div class="grid gap-4">
                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="warmup_1">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">1. Jumping Jacks</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'Q4QnlZs9PqI')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="warmup_2">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">2. Arm Swings & Thoracic Openers</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, '7XctvtQxcpE')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="warmup_3">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">3. Bodyweight Good-Mornings</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'Kdeq15AvUVU')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="warmup_4">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">4. Alternating Reverse Lunge + Reach</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'Lvqm1kmYb6k')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="warmup_5">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">5. Inchworm to Cobra</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'dtJq5pau5dY')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Circuit Section -->
        <section id="circuit-section" class="workout-section hidden">
            <h2 class="text-2xl font-bold mb-4 text-primary">Main Circuit (22-25 minutes)</h2>
            <p class="mb-4 text-gray-600 dark:text-gray-400">3 rounds ‚Ä¢ Work/Rest varies by week ‚Ä¢ 60s rest between rounds</p>
            <div class="grid gap-4">
                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_1">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">1. Handstand Push-up / Pike Push-up</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'qbRbM6d5ddM')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_2">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">2. Split-squat Iso Hold (L)</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'n-C0T-JQeUU')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_3">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">3. Split-squat Iso Hold (R)</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'n-C0T-JQeUU')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_4">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">4. Levitation Squat</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'EHocz1P-0iQ')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_5">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">5. Rotational Push-up</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'z9g54-vLd4A')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_6">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">6. Hip Thrust</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'SEdqd1n0cvg')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_7">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">7. Cobra Triceps Extension</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'AWedsdxUa7w')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_8">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">8. Reverse Iron-cross</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, '59F3EtPYmWU')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_9">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">9. Heel Touch Crunch</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, '9bR-elyolBQ')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="circuit_10">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">10. Star Plank</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'a3hfwl9Sidc')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Finisher Section -->
        <section id="finisher-section" class="workout-section hidden">
            <h2 class="text-2xl font-bold mb-4 text-primary">Conditioning Finisher (5 minutes)</h2>
            <p class="mb-4 text-gray-600 dark:text-gray-400">Tabata Protocol: 20s on / 10s off √ó 10 rounds (Pick one exercise)</p>
            <div class="grid gap-4">
                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="finisher_1">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">Option 1: Burpees</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'TU8QYVW0gDU')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="finisher_2">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">Option 2: Mountain-climber Sprints</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'nmwgirgXLYM')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="finisher_3">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">Option 3: High-knee Run in Place</h3>
                            <div class="rep-counter">Reps: <span class="reps">0</span></div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'OAJ_J3EZkdY')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cool-down Section -->
        <section id="cooldown-section" class="workout-section hidden">
            <h2 class="text-2xl font-bold mb-4 text-primary">Cool-down / Mobility (3 minutes)</h2>
            <p class="mb-4 text-gray-600 dark:text-gray-400">Hold each stretch for 60 seconds</p>
            <div class="grid gap-4">
                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="cooldown_1">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">1. Child's Pose ‚Üí Cobra Stretch</h3>
                            <div class="rep-counter">Hold: <span class="reps">0</span>s</div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, '4xPXuE0z19Y')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="cooldown_2">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">2. Couch Stretch</h3>
                            <div class="rep-counter">Hold: <span class="reps">0</span>s</div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'Fg-lwNBzVV8')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>

                <div class="exercise-card bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden" data-exercise="cooldown_3">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold">3. Doorway Pec Stretch</h3>
                            <div class="rep-counter">Hold: <span class="reps">0</span>s</div>
                        </div>
                        <div class="video-placeholder" onclick="loadVideo(this, 'B9uY01NoqBg')">
                            <div class="play-btn">‚ñ∂</div>
                            <div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,0.7);color:white;padding:4px 8px;border-radius:4px;font-size:12px">Click to load video</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Rep Counter Modal -->
        <div id="repModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                <h3 class="text-lg font-semibold mb-4">Count Your Reps</h3>
                <div class="text-center mb-4">
                    <div class="text-4xl font-bold mb-2" id="repCount">0</div>
                    <button type="button" id="repPlus" class="bg-primary text-white text-2xl w-16 h-16 rounded-full hover:bg-primary-dark">+</button>
                </div>
                <div class="flex justify-center space-x-3">
                    <button type="button" id="repDone" class="px-4 py-2 bg-green-500 text-white hover:bg-green-600 rounded">Done</button>
                    <button type="button" id="repCancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Workout Summary Modal -->
        <div id="summaryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <div class="text-center flex-1">
                        <h2 class="text-2xl font-bold text-green-600 mb-2">üéâ Workout Complete!</h2>
                        <p class="text-gray-600 dark:text-gray-400">Great job! Here's your workout summary:</p>
                    </div>
                    <button id="closeSummaryX" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl ml-4 flex-shrink-0">√ó</button>
                </div>
                
                <div class="space-y-4 mb-6" id="summaryContent">
                    <!-- Summary content will be populated here -->
                </div>
                
                <div class="space-y-3">
                    <button id="saveProgressBtn" class="w-full bg-primary text-white py-3 px-4 rounded-lg font-semibold hover:bg-primary-dark transition-colors">
                        üíæ Save Workout Data
                    </button>
                    <button id="copyProgressBtn" class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        üìã Copy Summary
                    </button>
                    <button id="shareFriendlyBtn" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        üì± Share Achievement
                    </button>
                    <button id="viewProgressBtn" class="w-full bg-purple-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                        üìä View Progress History
                    </button>
                    <button id="closeSummaryBtn" class="w-full bg-gray-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                        ‚ú® Start New Workout
                    </button>
                </div>
            </div>
        </div>

        <!-- Progress History Modal -->
        <div id="progressModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-primary">üìä Progress History</h2>
                    <button id="closeProgressBtn" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl">√ó</button>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">üìÅ Load Previous Workouts:</label>
                    <input type="file" id="fileInput" accept=".json,.txt" multiple class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-base">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Upload your saved workout files to see progress trends</p>
                </div>
                
                <div id="progressContent" class="space-y-4">
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        Upload your workout files to see your progress history and trends! üìà
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Cache DOM elements for better performance
        const DOM = {
            mainTimer: document.getElementById('mainTimer'),
            timerStatus: document.getElementById('timerStatus'),
            globalTimer: document.getElementById('globalTimer'),
            currentPhase: document.getElementById('currentPhase'),
            totalReps: document.getElementById('totalReps'),
            currentRound: document.getElementById('currentRound'),
            roundInfo: document.getElementById('roundInfo'),
            targetReps: document.getElementById('targetReps'),
            startBtn: document.getElementById('startBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            skipBtn: document.getElementById('skipBtn'),
            completeBtn: document.getElementById('completeBtn'),
            resetBtn: document.getElementById('resetBtn'),
            weekSelector: document.getElementById('weekSelector'),
            repModal: document.getElementById('repModal'),
            repCount: document.getElementById('repCount'),
            repPlus: document.getElementById('repPlus'),
            repDone: document.getElementById('repDone'),
            repCancel: document.getElementById('repCancel')
        };

        // Global state
        let workoutState = {
            phase: 'ready', // ready, warmup, circuit, finisher, cooldown, complete
            isRunning: false,
            isPaused: false,
            pausedStatus: '', // Store status before pausing
            currentWeek: 1,
            currentExercise: 0,
            currentRound: 0,
            totalReps: 0,
            globalStartTime: null,
            globalTimer: null,
            workoutTimer: null,
            exerciseTimer: null,
            timeRemaining: 0,
            exerciseReps: {}
        };

        // Week progression settings
        const weekSettings = {
            1: { work: 45, rest: 15, goal: "Learn form, note rep totals" },
            2: { work: 50, rest: 10, goal: "+5-10% total reps" },
            3: { work: 55, rest: 5, goal: "+5-10% total reps" },
            4: { work: 60, rest: 0, goal: "+5-10% total reps" }
        };

        // Exercise sequences
        const sequences = {
            warmup: ['warmup_1', 'warmup_2', 'warmup_3', 'warmup_4', 'warmup_5'],
            circuit: ['circuit_1', 'circuit_2', 'circuit_3', 'circuit_4', 'circuit_5', 'circuit_6', 'circuit_7', 'circuit_8', 'circuit_9', 'circuit_10'],
            finisher: ['finisher_1'], // User selects one
            cooldown: ['cooldown_1', 'cooldown_2', 'cooldown_3']
        };

        // Simplified Audio notification system - PWA optimized
        let audioInitialized = false;
        let audioContext = null;

        function initAudio() {
            if (audioInitialized) return;
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                audioInitialized = true;
                console.log('üîä Audio ready for notifications!');
            } catch (e) {
                console.log('Audio context not available');
            }
        }

        function playPingSound() {
            console.log('üîî Timer notification triggered');
            
            // Always do vibration + visual first (works reliably)
            if ('vibrate' in navigator) {
                navigator.vibrate([150, 75, 150]);
            }
            
            // Visual flash
            const flash = document.createElement('div');
            flash.className = 'fixed inset-0 bg-green-400 opacity-60 pointer-events-none z-50';
            flash.style.animation = 'ping 0.4s cubic-bezier(0, 0, 0.2, 1)';
            document.body.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    document.body.removeChild(flash);
                }
            }, 400);
            
            // Try simple audio
            try {
                if (audioContext && audioContext.state !== 'suspended') {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.frequency.setValueAtTime(800, audioContext.currentTime);
                    osc.type = 'sine';
                    
                    gain.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    
                    osc.start();
                    osc.stop(audioContext.currentTime + 0.2);
                    
                    console.log('üéµ Audio ping played');
                } else {
                    // Try simple beep fallback
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmMiBhKJ2O/NfTUGHHbG7+OWQwooVK3n77BdGAhBl+P8xmgfCjF3yPDalUgJG2K48+mjWBIJ');
                    audio.volume = 0.1;
                    audio.play().catch(() => console.log('Audio fallback failed'));
                }
            } catch (error) {
                console.log('Audio failed, using visual notification only');
            }
            
            // Always show toast as final fallback
            showToast('‚è∞ Exercise Complete!');
        }

        // Initialize audio on user interaction
        document.addEventListener('click', initAudio, { once: true });
        document.addEventListener('touchstart', initAudio, { once: true });

        // Utility functions
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateGlobalTimer() {
            if (workoutState.globalStartTime && workoutState.isRunning && !workoutState.isPaused) {
                const elapsed = Math.floor((Date.now() - workoutState.globalStartTime) / 1000);
                document.getElementById('globalTimer').textContent = formatTime(elapsed);
            }
        }

        function updateMainTimer() {
            document.getElementById('mainTimer').textContent = formatTime(workoutState.timeRemaining);
        }

        function updateUI() {
            document.getElementById('currentPhase').textContent = workoutState.phase.charAt(0).toUpperCase() + workoutState.phase.slice(1);
            document.getElementById('totalReps').textContent = workoutState.totalReps;
            
            if (workoutState.phase === 'circuit') {
                document.getElementById('roundInfo').classList.remove('hidden');
                document.getElementById('currentRound').textContent = workoutState.currentRound;
            } else {
                document.getElementById('roundInfo').classList.add('hidden');
            }

            const goal = weekSettings[workoutState.currentWeek].goal;
            document.getElementById('targetReps').textContent = goal;
        }

        function clearExerciseStates() {
            document.querySelectorAll('.exercise-card').forEach(card => {
                card.classList.remove('exercise-active', 'exercise-completed', 'rest-mode');
            });
        }

        function highlightCurrentExercise(exerciseId) {
            clearExerciseStates();
            const card = document.querySelector(`[data-exercise="${exerciseId}"]`);
            if (card) {
                card.classList.add('exercise-active');
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function markExerciseCompleted(exerciseId) {
            const card = document.querySelector(`[data-exercise="${exerciseId}"]`);
            if (card) {
                card.classList.remove('exercise-active');
                card.classList.add('exercise-completed');
            }
        }

        function showRestMode() {
            clearExerciseStates();
            document.querySelector('.exercise-card').classList.add('rest-mode');
        }

        // Rep counting
        function showRepModal(exerciseId, callback) {
            const modal = document.getElementById('repModal');
            const repCount = document.getElementById('repCount');
            const repPlus = document.getElementById('repPlus');
            const repDone = document.getElementById('repDone');
            const repCancel = document.getElementById('repCancel');
            
            let reps = 0;
            repCount.textContent = reps;
            modal.classList.remove('hidden');
            
            const incrementRep = (e) => {
                e.preventDefault();
                e.stopPropagation();
                reps++;
                repCount.textContent = reps;
            };
            
            const done = (e) => {
                e.preventDefault();
                e.stopPropagation();
                modal.classList.add('hidden');
                callback(reps);
                cleanup();
            };
            
            const cancel = (e) => {
                e.preventDefault();
                e.stopPropagation();
                modal.classList.add('hidden');
                callback(0);
                cleanup();
            };
            
            const cleanup = () => {
                repPlus.removeEventListener('click', incrementRep);
                repDone.removeEventListener('click', done);
                repCancel.removeEventListener('click', cancel);
            };
            
            repPlus.addEventListener('click', incrementRep);
            repDone.addEventListener('click', done);
            repCancel.addEventListener('click', cancel);
        }

        function updateExerciseReps(exerciseId, reps) {
            workoutState.exerciseReps[exerciseId] = (workoutState.exerciseReps[exerciseId] || 0) + reps;
            workoutState.totalReps += reps;
            
            const card = document.querySelector(`[data-exercise="${exerciseId}"]`);
            if (card) {
                const repDisplay = card.querySelector('.reps');
                if (repDisplay) {
                    repDisplay.textContent = workoutState.exerciseReps[exerciseId];
                }
            }
            
            updateUI();
        }

        // Workout phases
        function startWorkout() {
            if (workoutState.phase === 'complete') {
                resetWorkout();
            }
            
            // Handle section transitions
            if (workoutState.phase === 'warmup-complete') {
                startCircuit();
                return;
            } else if (workoutState.phase === 'circuit-complete') {
                switchToSection('finisher');
                document.getElementById('timerStatus').textContent = 'Choose a finisher exercise or skip to cool-down';
                return;
            } else if (workoutState.phase === 'finisher-complete') {
                startCooldown();
                return;
            }
            
            workoutState.isRunning = true;
            workoutState.isPaused = false;
            workoutState.globalStartTime = Date.now();
            
            workoutState.globalTimer = setInterval(updateGlobalTimer, 1000);
            
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');
            document.getElementById('skipBtn').classList.remove('hidden');
            document.getElementById('completeBtn').classList.remove('hidden');
            
            if (workoutState.phase === 'ready') {
                startWarmup();
            }
            
            updateUI();
        }

        function startWarmup() {
            workoutState.phase = 'warmup';
            workoutState.currentExercise = 0;
            switchToSection('warmup');
            runWarmupSequence();
        }

        function runWarmupSequence() {
            const exercises = sequences.warmup;
            
            function nextExercise() {
                if (workoutState.currentExercise >= exercises.length) {
                    completeWarmup();
                    return;
                }
                
                const exerciseId = exercises[workoutState.currentExercise];
                highlightCurrentExercise(exerciseId);
                
                document.getElementById('timerStatus').textContent = `${exerciseId.replace('_', ' ').toUpperCase()} - GO!`;
                workoutState.timeRemaining = 30;
                
                workoutState.exerciseTimer = setInterval(() => {
                    if (!workoutState.isPaused) {
                        workoutState.timeRemaining--;
                        updateMainTimer();
                        
                        if (workoutState.timeRemaining <= 0) {
                            clearInterval(workoutState.exerciseTimer);
                            playPingSound(); // Play notification sound
                            
                            showRepModal(exerciseId, (reps) => {
                                updateExerciseReps(exerciseId, reps);
                                markExerciseCompleted(exerciseId);
                                workoutState.currentExercise++;
                                setTimeout(nextExercise, 500);
                            });
                        }
                    }
                }, 1000);
            }
            
            nextExercise();
        }

        function completeWarmup() {
            clearExerciseStates();
            workoutState.isRunning = false;
            workoutState.phase = 'warmup-complete';
            
            clearInterval(workoutState.globalTimer);
            clearInterval(workoutState.exerciseTimer);
            
            document.getElementById('timerStatus').textContent = 'Warmup Complete! Press Start to begin Circuit';
            document.getElementById('startBtn').textContent = 'üöÄ Start Circuit';
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('skipBtn').classList.add('hidden');
            document.getElementById('completeBtn').classList.add('hidden');
        }

        function startCircuit() {
            workoutState.phase = 'circuit';
            workoutState.currentRound = 1;
            workoutState.currentExercise = 0;
            workoutState.isRunning = true;
            workoutState.isPaused = false;
            workoutState.globalStartTime = Date.now();
            
            // Start global timer if not already running
            if (!workoutState.globalTimer) {
                workoutState.globalTimer = setInterval(updateGlobalTimer, 1000);
            }
            
            // Update button states for circuit phase
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');
            document.getElementById('skipBtn').classList.remove('hidden');
            document.getElementById('completeBtn').classList.remove('hidden');
            
            switchToSection('circuit');
            runCircuitRound();
        }

        function runCircuitRound() {
            const exercises = sequences.circuit;
            const settings = weekSettings[workoutState.currentWeek];
            
            function nextExercise() {
                if (workoutState.currentExercise >= exercises.length) {
                    completeCircuitRound();
                    return;
                }
                
                const exerciseId = exercises[workoutState.currentExercise];
                highlightCurrentExercise(exerciseId);
                
                document.getElementById('timerStatus').textContent = `Round ${workoutState.currentRound} - ${exerciseId.replace('_', ' ').toUpperCase()} - GO!`;
                workoutState.timeRemaining = settings.work;
                
                workoutState.exerciseTimer = setInterval(() => {
                    if (!workoutState.isPaused) {
                        workoutState.timeRemaining--;
                        updateMainTimer();
                        
                        if (workoutState.timeRemaining <= 0) {
                            clearInterval(workoutState.exerciseTimer);
                            playPingSound(); // Play notification sound
                            
                            showRepModal(exerciseId, (reps) => {
                                updateExerciseReps(exerciseId, reps);
                                markExerciseCompleted(exerciseId);
                                
                                if (settings.rest > 0) {
                                    startTransition(settings.rest);
                                } else {
                                    workoutState.currentExercise++;
                                    setTimeout(nextExercise, 500);
                                }
                            });
                        }
                    }
                }, 1000);
            }
            
            function startTransition(restTime) {
                showRestMode();
                document.getElementById('timerStatus').textContent = 'Transition - Get Ready!';
                workoutState.timeRemaining = restTime;
                
                workoutState.exerciseTimer = setInterval(() => {
                    if (!workoutState.isPaused) {
                        workoutState.timeRemaining--;
                        updateMainTimer();
                        
                        if (workoutState.timeRemaining <= 0) {
                            clearInterval(workoutState.exerciseTimer);
                            playPingSound(); // Play notification sound for transition end
                            workoutState.currentExercise++;
                            setTimeout(nextExercise, 500);
                        }
                    }
                }, 1000);
            }
            
            nextExercise();
        }

        function completeCircuitRound() {
            workoutState.currentExercise = 0;
            
            if (workoutState.currentRound < 3) {
                // Rest between rounds
                showRestMode();
                document.getElementById('timerStatus').textContent = `Round ${workoutState.currentRound} Complete - Rest!`;
                workoutState.timeRemaining = 60;
                
                workoutState.exerciseTimer = setInterval(() => {
                    if (!workoutState.isPaused) {
                        workoutState.timeRemaining--;
                        updateMainTimer();
                        
                        if (workoutState.timeRemaining <= 0) {
                            clearInterval(workoutState.exerciseTimer);
                            playPingSound(); // Play notification sound for round rest completion
                            workoutState.currentRound++;
                            updateUI();
                            setTimeout(runCircuitRound, 1000);
                        }
                    }
                }, 1000);
            } else {
                completeCircuit();
            }
        }

        function completeCircuit() {
            clearExerciseStates();
            workoutState.isRunning = false;
            workoutState.phase = 'circuit-complete';
            
            clearInterval(workoutState.globalTimer);
            clearInterval(workoutState.exerciseTimer);
            
            document.getElementById('timerStatus').textContent = 'Circuit Complete! Choose Finisher or Press Start to Skip to Cool-down';
            document.getElementById('startBtn').textContent = 'üöÄ Skip to Cool-down';
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('skipBtn').classList.add('hidden');
            document.getElementById('completeBtn').classList.add('hidden');
            
            switchToSection('finisher');
        }

        function startFinisher(exerciseId) {
            workoutState.phase = 'finisher';
            workoutState.currentExercise = 0;
            
            // Highlight selected exercise
            highlightCurrentExercise(exerciseId);
            
            runTabataProtocol(exerciseId);
        }

        function runTabataProtocol(exerciseId) {
            let currentRound = 1;
            const totalRounds = 10;
            
            function runRound() {
                if (currentRound > totalRounds) {
                    completeFinisher();
                    return;
                }
                
                // Work phase (20s)
                document.getElementById('timerStatus').textContent = `Tabata Round ${currentRound}/${totalRounds} - GO!`;
                workoutState.timeRemaining = 20;
                
                workoutState.exerciseTimer = setInterval(() => {
                    if (!workoutState.isPaused) {
                        workoutState.timeRemaining--;
                        updateMainTimer();
                        
                        if (workoutState.timeRemaining <= 0) {
                            clearInterval(workoutState.exerciseTimer);
                            
                            playPingSound(); // Play notification sound
                            
                            showRepModal(exerciseId, (reps) => {
                                updateExerciseReps(exerciseId, reps);
                                
                                if (currentRound < totalRounds) {
                                    startRestPhase();
                                } else {
                                    currentRound++;
                                    setTimeout(runRound, 500);
                                }
                            });
                        }
                    }
                }, 1000);
                
                function startRestPhase() {
                    showRestMode();
                    document.getElementById('timerStatus').textContent = `Rest - Round ${currentRound}/${totalRounds}`;
                    workoutState.timeRemaining = 10;
                    
                    workoutState.exerciseTimer = setInterval(() => {
                        if (!workoutState.isPaused) {
                            workoutState.timeRemaining--;
                            updateMainTimer();
                            
                            if (workoutState.timeRemaining <= 0) {
                                clearInterval(workoutState.exerciseTimer);
                                highlightCurrentExercise(exerciseId);
                                currentRound++;
                                setTimeout(runRound, 500);
                            }
                        }
                    }, 1000);
                }
            }
            
            runRound();
        }

        function completeFinisher() {
            clearExerciseStates();
            workoutState.isRunning = false;
            workoutState.phase = 'finisher-complete';
            
            clearInterval(workoutState.globalTimer);
            clearInterval(workoutState.exerciseTimer);
            
            document.getElementById('timerStatus').textContent = 'Finisher Complete! Press Start for Cool-down';
            document.getElementById('startBtn').textContent = 'üöÄ Start Cool-down';
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('skipBtn').classList.add('hidden');
            document.getElementById('completeBtn').classList.add('hidden');
        }

        function startCooldown() {
            workoutState.phase = 'cooldown';
            workoutState.currentExercise = 0;
            switchToSection('cooldown');
            runCooldownSequence();
        }

        function runCooldownSequence() {
            const exercises = sequences.cooldown;
            
            function nextStretch() {
                if (workoutState.currentExercise >= exercises.length) {
                    completeWorkout();
                    return;
                }
                
                const exerciseId = exercises[workoutState.currentExercise];
                highlightCurrentExercise(exerciseId);
                
                document.getElementById('timerStatus').textContent = `${exerciseId.replace('_', ' ').toUpperCase()} - Hold`;
                workoutState.timeRemaining = 60;
                
                let seconds = 0;
                workoutState.exerciseTimer = setInterval(() => {
                    if (!workoutState.isPaused) {
                        workoutState.timeRemaining--;
                        seconds++;
                        updateMainTimer();
                        
                        // Update hold time display
                        const card = document.querySelector(`[data-exercise="${exerciseId}"]`);
                        if (card) {
                            const repDisplay = card.querySelector('.reps');
                            if (repDisplay) {
                                repDisplay.textContent = seconds;
                            }
                        }
                        
                        if (workoutState.timeRemaining <= 0) {
                            clearInterval(workoutState.exerciseTimer);
                            markExerciseCompleted(exerciseId);
                            workoutState.currentExercise++;
                            setTimeout(nextStretch, 1000);
                        }
                    }
                }, 1000);
            }
            
            nextStretch();
        }

        function completeWorkout() {
            workoutState.phase = 'complete';
            workoutState.isRunning = false;
            clearExerciseStates();
            
            clearInterval(workoutState.globalTimer);
            clearInterval(workoutState.exerciseTimer);
            
            // Calculate total workout time
            const totalWorkoutTime = Math.floor((Date.now() - workoutState.globalStartTime) / 1000);
            
            document.getElementById('timerStatus').textContent = `üéâ Workout Complete! Total Reps: ${workoutState.totalReps}`;
            
            // Hide all control buttons except show the start button as "New Workout"
            document.getElementById('startBtn').textContent = '‚ú® Start New Workout';
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('skipBtn').classList.add('hidden');
            document.getElementById('completeBtn').classList.add('hidden');
            
            updateUI();
            
            // Show workout summary
            showWorkoutSummary(totalWorkoutTime);
        }

        // Workout Summary Functions
        function showWorkoutSummary(totalTime) {
            const modal = document.getElementById('summaryModal');
            const content = document.getElementById('summaryContent');
            
            const summary = generateWorkoutSummary(totalTime);
            content.innerHTML = summary.html;
            
            modal.classList.remove('hidden');
            
            // Store summary data for export
            window.workoutSummaryData = summary;
        }

        function generateWorkoutSummary(totalTime) {
            const date = new Date();
            const dateStr = date.toLocaleDateString();
            const timeStr = date.toLocaleTimeString();
            
            // Get exercise breakdown
            const exerciseBreakdown = {};
            const exerciseNames = {
                warmup_1: 'Jumping Jacks',
                warmup_2: 'Arm Swings & Thoracic Openers', 
                warmup_3: 'Bodyweight Good-Mornings',
                warmup_4: 'Alternating Reverse Lunge + Reach',
                warmup_5: 'Inchworm to Cobra',
                circuit_1: 'Handstand Push-up / Pike Push-up',
                circuit_2: 'Split-squat Iso Hold (L)',
                circuit_3: 'Split-squat Iso Hold (R)',
                circuit_4: 'Levitation Squat',
                circuit_5: 'Rotational Push-up',
                circuit_6: 'Hip Thrust',
                circuit_7: 'Cobra Triceps Extension',
                circuit_8: 'Reverse Iron-cross',
                circuit_9: 'Heel Touch Crunch',
                circuit_10: 'Star Plank',
                finisher_1: 'Burpees',
                finisher_2: 'Mountain-climber Sprints',
                finisher_3: 'High-knee Run in Place',
                cooldown_1: 'Child\'s Pose ‚Üí Cobra Stretch',
                cooldown_2: 'Couch Stretch',
                cooldown_3: 'Doorway Pec Stretch'
            };

            let html = `
                <div class="bg-gradient-to-r from-primary/10 to-orange-100 dark:from-primary/20 dark:to-orange-900/20 p-4 rounded-lg mb-4">
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-2xl font-bold text-primary">${workoutState.totalReps}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Total Reps</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-primary">${formatTime(totalTime)}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Workout Time</div>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        <strong>Date:</strong> ${dateStr} at ${timeStr}<br>
                        <strong>Week:</strong> ${workoutState.currentWeek} (${weekSettings[workoutState.currentWeek].work}s work / ${weekSettings[workoutState.currentWeek].rest}s rest)
                    </div>
            `;

            // Add exercise breakdown
            const categories = [
                { title: 'üî• Warmup', exercises: sequences.warmup },
                { title: 'üí™ Circuit', exercises: sequences.circuit },
                { title: '‚ö° Finisher', exercises: sequences.finisher },
                { title: 'üßò Cool-down', exercises: sequences.cooldown }
            ];

            categories.forEach(category => {
                if (category.exercises.some(ex => workoutState.exerciseReps[ex] > 0)) {
                    html += `<div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                        <h4 class="font-semibold mb-2">${category.title}</h4>
                        <div class="space-y-1 text-sm">`;
                    
                    category.exercises.forEach(exerciseId => {
                        const reps = workoutState.exerciseReps[exerciseId] || 0;
                        if (reps > 0) {
                            const name = exerciseNames[exerciseId] || exerciseId;
                            const unit = category.title.includes('Cool-down') ? 's held' : ' reps';
                            html += `<div class="flex justify-between">
                                <span>${name}:</span>
                                <span class="font-medium">${reps}${unit}</span>
                            </div>`;
                        }
                    });
                    
                    html += `</div></div>`;
                }
            });

            html += `</div>`;

            // Generate text version for export
            const textSummary = `üí™ Progressive Workout Summary

üìÖ Date: ${dateStr} at ${timeStr}
‚è±Ô∏è Total Time: ${formatTime(totalTime)}
üî• Total Reps: ${workoutState.totalReps}
üìä Week: ${workoutState.currentWeek} (${weekSettings[workoutState.currentWeek].work}s work / ${weekSettings[workoutState.currentWeek].rest}s rest)

EXERCISE BREAKDOWN:
${categories.map(category => {
    const relevantExercises = category.exercises.filter(ex => workoutState.exerciseReps[ex] > 0);
    if (relevantExercises.length === 0) return '';
    
    return `${category.title}
${relevantExercises.map(exerciseId => {
        const reps = workoutState.exerciseReps[exerciseId];
        const name = exerciseNames[exerciseId] || exerciseId;
        const unit = category.title.includes('Cool-down') ? 's held' : ' reps';
        return `‚Ä¢ ${name}: ${reps}${unit}`;
    }).join('\n')}`;
}).filter(section => section).join('\n\n')}

Generated by Progressive Workout App üöÄ
Keep up the great work! üí™`;

            return { html, text: textSummary, data: {
                date: dateStr,
                time: timeStr,
                totalTime: formatTime(totalTime),
                totalReps: workoutState.totalReps,
                week: workoutState.currentWeek,
                exercises: workoutState.exerciseReps
            }};
        }

        // Progress Tracking State
        let progressHistory = [];

        // Save/Export Functions - Crash-safe version
        function saveProgress() {
            try {
                const summary = window.workoutSummaryData;
                if (!summary) {
                    showToast('‚ùå No workout data to save');
                    return;
                }
                
                // Create comprehensive workout data object
                const workoutData = {
                    version: "1.0",
                    type: "ProgressiveWorkout",
                    timestamp: new Date().toISOString(),
                    date: summary.data.date,
                    time: summary.data.time,
                    week: summary.data.week,
                    totalReps: summary.data.totalReps,
                    totalTimeSeconds: workoutState.globalStartTime ? 
                        Math.floor((Date.now() - workoutState.globalStartTime) / 1000) : 0,
                    totalTime: summary.data.totalTime,
                    exercises: summary.data.exercises,
                    settings: weekSettings[workoutState.currentWeek],
                    performance: {
                        completedSections: ['warmup', 'circuit', 'finisher', 'cooldown'].filter(section => 
                            sequences[section] && sequences[section].some(ex => workoutState.exerciseReps[ex] > 0)
                        ),
                        averageRepsPerExercise: Object.keys(summary.data.exercises).length > 0 ? 
                            Math.round(summary.data.totalReps / Object.keys(summary.data.exercises).length) : 0
                    }
                };
                
                const filename = `Progressive_Workout_${new Date().toISOString().split('T')[0]}.json`;
                const jsonData = JSON.stringify(workoutData, null, 2);
                
                // Try mobile-friendly options first
                if (tryMobileShare(jsonData, filename)) {
                    return; // Success with mobile share
                }
                
                // Fallback to download
                tryDownload(jsonData, filename);
                
            } catch (error) {
                console.error('Save function error:', error);
                showToast('‚ùå Save failed - try copying data instead');
                
                // Emergency fallback: copy to clipboard
                try {
                    const summary = window.workoutSummaryData;
                    if (summary && navigator.clipboard) {
                        navigator.clipboard.writeText(summary.text).then(() => {
                            showToast('üìã Workout copied to clipboard as backup!');
                        });
                    }
                } catch (clipboardError) {
                    showToast('‚ùå Complete save failure');
                }
            }
        }

        function tryMobileShare(jsonData, filename) {
            try {
                // Only try Web Share if it's definitely supported
                if (navigator.share && 'canShare' in navigator) {
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const file = new File([blob], filename, { type: 'application/json' });
                    
                    // Test if files can be shared
                    if (navigator.canShare({ files: [file] })) {
                        navigator.share({
                            title: 'Progressive Workout Data',
                            text: 'My workout progress file',
                            files: [file]
                        }).then(() => {
                            showToast('üìÅ Workout file shared successfully! üéâ');
                        }).catch((error) => {
                            console.log('Share cancelled or failed:', error);
                            tryDownload(jsonData, filename);
                        });
                        return true;
                    }
                }
                
                // Try simple share without files
                if (navigator.share) {
                    navigator.share({
                        title: 'Progressive Workout Data',
                        text: `Workout data saved! Copy this data:\n\n${jsonData.substring(0, 200)}...`
                    }).then(() => {
                        showToast('üì± Share successful - data in message!');
                        tryDownload(jsonData, filename); // Also try download
                    }).catch(() => {
                        return false; // Failed, try download
                    });
                    return true;
                }
                
                return false; // No share API available
                
            } catch (error) {
                console.log('Mobile share failed:', error);
                return false;
            }
        }

        function tryDownload(jsonData, filename) {
            try {
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Create download link
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = filename;
                
                // Add to DOM temporarily
                document.body.appendChild(a);
                
                // Try to trigger download
                a.click();
                
                // Clean up immediately
                document.body.removeChild(a);
                
                // Clean up URL after delay
                setTimeout(() => {
                    try {
                        URL.revokeObjectURL(url);
                    } catch (cleanupError) {
                        // Ignore cleanup errors
                    }
                }, 1000);
                
                showToast(`üíæ ${filename} saved to Downloads! üìÅ`);
                
            } catch (downloadError) {
                console.error('Download failed:', downloadError);
                showToast('‚ùå Download failed - data copied to clipboard instead');
                
                // Final fallback: clipboard
                try {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(jsonData).then(() => {
                            showToast('üìã Workout data copied to clipboard! üìã');
                        });
                    }
                } catch (clipboardError) {
                    showToast('‚ùå All save methods failed');
                }
            }
        }

        function copyProgress() {
            const summary = window.workoutSummaryData;
            if (!summary) return;
            
            navigator.clipboard.writeText(summary.text).then(() => {
                showToast('üìã Workout copied to clipboard!');
            }).catch(err => {
                showToast('‚ùå Could not copy to clipboard');
            });
        }

        function shareProgress() {
            const summary = window.workoutSummaryData;
            if (!summary) return;
            
            // Create a shortened, mobile-friendly version
            const shareText = `üî• Just completed my workout!

üí™ Total Reps: ${summary.data.totalReps}
‚è±Ô∏è Time: ${summary.data.totalTime}
üìä Week ${summary.data.week} Progress

#ProgressiveWorkout #Fitness #WorkoutComplete`;

            if (navigator.share) {
                navigator.share({
                    title: 'My Workout Summary',
                    text: shareText
                }).then(() => {
                    showToast('üì± Shared successfully!');
                }).catch(() => {
                    // Fallback to clipboard
                    navigator.clipboard.writeText(shareText).then(() => {
                        showToast('üìã Share text copied to clipboard!');
                    });
                });
            } else {
                // Fallback for browsers without Web Share API
                navigator.clipboard.writeText(shareText).then(() => {
                    showToast('üìã Share text copied to clipboard!');
                }).catch(() => {
                    showToast('‚ùå Could not copy share text');
                });
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        function closeSummary() {
            document.getElementById('summaryModal').classList.add('hidden');
            
            // Reset workout for new session
            setTimeout(() => {
                resetWorkout();
            }, 300);
        }

        // Navigation
        function switchToSection(sectionName) {
            const navTabs = document.querySelectorAll('.nav-tab');
            const sections = document.querySelectorAll('.workout-section');
            
            navTabs.forEach(tab => {
                tab.classList.remove('active', 'bg-primary', 'text-white');
                if (tab.dataset.section === sectionName) {
                    tab.classList.add('active', 'bg-primary', 'text-white');
                }
            });
            
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName + '-section').classList.remove('hidden');
        }

        // Controls
        function pauseWorkout() {
            workoutState.isPaused = !workoutState.isPaused;
            
            if (workoutState.isPaused) {
                // Store current status before pausing
                workoutState.pausedStatus = document.getElementById('timerStatus').textContent;
                document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è Resume';
                document.getElementById('timerStatus').textContent = 'Paused';
            } else {
                // Restore previous status when resuming
                document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';
                document.getElementById('timerStatus').textContent = workoutState.pausedStatus || 'Running';
            }
        }

        function resetTimers() {
            // Clear current exercise timer only
            clearInterval(workoutState.exerciseTimer);
            
            // Reset only timer-related state
            workoutState.timeRemaining = 0;
            workoutState.isPaused = false;
            
            // Reset timer display
            document.getElementById('mainTimer').textContent = '00:00';
            document.getElementById('timerStatus').textContent = workoutState.isRunning ? 'Timer Reset - Ready to Continue' : 'Ready to Start';
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';
            
            // Clear exercise highlighting but keep completed states
            document.querySelectorAll('.exercise-card').forEach(card => {
                card.classList.remove('exercise-active', 'rest-mode');
            });
        }

        function resetWorkout() {
            // Complete reset
            clearInterval(workoutState.globalTimer);
            clearInterval(workoutState.exerciseTimer);
            
            workoutState = {
                phase: 'ready',
                isRunning: false,
                isPaused: false,
                pausedStatus: '',
                currentWeek: workoutState.currentWeek, // Keep week selection
                currentExercise: 0,
                currentRound: 0,
                totalReps: 0,
                globalStartTime: null,
                globalTimer: null,
                workoutTimer: null,
                exerciseTimer: null,
                timeRemaining: 0,
                exerciseReps: {}
            };
            
            // Reset UI
            document.getElementById('mainTimer').textContent = '00:00';
            document.getElementById('timerStatus').textContent = 'Ready to Start';
            document.getElementById('globalTimer').textContent = '00:00';
            document.getElementById('startBtn').textContent = 'üöÄ Start Workout';
            document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';
            
            clearExerciseStates();
            
            // Reset all rep counters
            document.querySelectorAll('.reps').forEach(rep => {
                rep.textContent = '0';
            });
            
            switchToSection('warmup');
            updateUI();
        }

        function skipExercise() {
            if (!workoutState.isRunning) return;
            
            // Clear current timer
            clearInterval(workoutState.exerciseTimer);
            
            // Mark current exercise as completed (with 0 reps)
            const currentSequence = sequences[workoutState.phase];
            if (currentSequence && workoutState.currentExercise < currentSequence.length) {
                const exerciseId = currentSequence[workoutState.currentExercise];
                updateExerciseReps(exerciseId, 0);
                markExerciseCompleted(exerciseId);
            }
            
            // Progress to next exercise based on current phase
            if (workoutState.phase === 'warmup') {
                workoutState.currentExercise++;
                if (workoutState.currentExercise >= sequences.warmup.length) {
                    completeWarmup();
                } else {
                    setTimeout(() => {
                        const exerciseId = sequences.warmup[workoutState.currentExercise];
                        highlightCurrentExercise(exerciseId);
                        document.getElementById('timerStatus').textContent = `${exerciseId.replace('_', ' ').toUpperCase()} - GO!`;
                        workoutState.timeRemaining = 30;
                        runWarmupTimer();
                    }, 500);
                }
            } else if (workoutState.phase === 'circuit') {
                workoutState.currentExercise++;
                if (workoutState.currentExercise >= sequences.circuit.length) {
                    completeCircuitRound();
                } else {
                    const settings = weekSettings[workoutState.currentWeek];
                    setTimeout(() => {
                        const exerciseId = sequences.circuit[workoutState.currentExercise];
                        highlightCurrentExercise(exerciseId);
                        document.getElementById('timerStatus').textContent = `Round ${workoutState.currentRound} - ${exerciseId.replace('_', ' ').toUpperCase()} - GO!`;
                        workoutState.timeRemaining = settings.work;
                        runCircuitTimer();
                    }, 500);
                }
            } else if (workoutState.phase === 'finisher') {
                completeFinisher();
            } else if (workoutState.phase === 'cooldown') {
                workoutState.currentExercise++;
                if (workoutState.currentExercise >= sequences.cooldown.length) {
                    completeWorkout();
                } else {
                    setTimeout(() => {
                        const exerciseId = sequences.cooldown[workoutState.currentExercise];
                        highlightCurrentExercise(exerciseId);
                        document.getElementById('timerStatus').textContent = `${exerciseId.replace('_', ' ').toUpperCase()} - Hold`;
                        workoutState.timeRemaining = 60;
                        runCooldownTimer();
                    }, 500);
                }
            }
        }

        function runWarmupTimer() {
            workoutState.exerciseTimer = setInterval(() => {
                if (!workoutState.isPaused) {
                    workoutState.timeRemaining--;
                    updateMainTimer();
                    
                    if (workoutState.timeRemaining <= 0) {
                        clearInterval(workoutState.exerciseTimer);
                        const exerciseId = sequences.warmup[workoutState.currentExercise];
                        showRepModal(exerciseId, (reps) => {
                            updateExerciseReps(exerciseId, reps);
                            markExerciseCompleted(exerciseId);
                            workoutState.currentExercise++;
                            if (workoutState.currentExercise >= sequences.warmup.length) {
                                completeWarmup();
                            } else {
                                setTimeout(() => {
                                    const nextExerciseId = sequences.warmup[workoutState.currentExercise];
                                    highlightCurrentExercise(nextExerciseId);
                                    document.getElementById('timerStatus').textContent = `${nextExerciseId.replace('_', ' ').toUpperCase()} - GO!`;
                                    workoutState.timeRemaining = 30;
                                    runWarmupTimer();
                                }, 500);
                            }
                        });
                    }
                }
            }, 1000);
        }

        function runCircuitTimer() {
            const settings = weekSettings[workoutState.currentWeek];
            workoutState.exerciseTimer = setInterval(() => {
                if (!workoutState.isPaused) {
                    workoutState.timeRemaining--;
                    updateMainTimer();
                    
                    if (workoutState.timeRemaining <= 0) {
                        clearInterval(workoutState.exerciseTimer);
                        const exerciseId = sequences.circuit[workoutState.currentExercise];
                        showRepModal(exerciseId, (reps) => {
                            updateExerciseReps(exerciseId, reps);
                            markExerciseCompleted(exerciseId);
                            
                            if (settings.rest > 0) {
                                showRestMode();
                                document.getElementById('timerStatus').textContent = 'Transition - Get Ready!';
                                workoutState.timeRemaining = settings.rest;
                                
                                workoutState.exerciseTimer = setInterval(() => {
                                    if (!workoutState.isPaused) {
                                        workoutState.timeRemaining--;
                                        updateMainTimer();
                                        
                                        if (workoutState.timeRemaining <= 0) {
                                            clearInterval(workoutState.exerciseTimer);
                                            workoutState.currentExercise++;
                                            if (workoutState.currentExercise >= sequences.circuit.length) {
                                                completeCircuitRound();
                                            } else {
                                                setTimeout(() => {
                                                    const nextExerciseId = sequences.circuit[workoutState.currentExercise];
                                                    highlightCurrentExercise(nextExerciseId);
                                                    document.getElementById('timerStatus').textContent = `Round ${workoutState.currentRound} - ${nextExerciseId.replace('_', ' ').toUpperCase()} - GO!`;
                                                    workoutState.timeRemaining = settings.work;
                                                    runCircuitTimer();
                                                }, 500);
                                            }
                                        }
                                    }
                                }, 1000);
                            } else {
                                workoutState.currentExercise++;
                                if (workoutState.currentExercise >= sequences.circuit.length) {
                                    completeCircuitRound();
                                } else {
                                    setTimeout(() => {
                                        const nextExerciseId = sequences.circuit[workoutState.currentExercise];
                                        highlightCurrentExercise(nextExerciseId);
                                        document.getElementById('timerStatus').textContent = `Round ${workoutState.currentRound} - ${nextExerciseId.replace('_', ' ').toUpperCase()} - GO!`;
                                        workoutState.timeRemaining = settings.work;
                                        runCircuitTimer();
                                    }, 500);
                                }
                            }
                        });
                    }
                }
            }, 1000);
        }

        function runCooldownTimer() {
            let seconds = 0;
            workoutState.exerciseTimer = setInterval(() => {
                if (!workoutState.isPaused) {
                    workoutState.timeRemaining--;
                    seconds++;
                    updateMainTimer();
                    
                    // Update hold time display
                    const exerciseId = sequences.cooldown[workoutState.currentExercise];
                    const card = document.querySelector(`[data-exercise="${exerciseId}"]`);
                    if (card) {
                        const repDisplay = card.querySelector('.reps');
                        if (repDisplay) {
                            repDisplay.textContent = seconds;
                        }
                    }
                    
                    if (workoutState.timeRemaining <= 0) {
                        clearInterval(workoutState.exerciseTimer);
                        markExerciseCompleted(exerciseId);
                        workoutState.currentExercise++;
                        if (workoutState.currentExercise >= sequences.cooldown.length) {
                            completeWorkout();
                        } else {
                            setTimeout(() => {
                                const nextExerciseId = sequences.cooldown[workoutState.currentExercise];
                                highlightCurrentExercise(nextExerciseId);
                                document.getElementById('timerStatus').textContent = `${nextExerciseId.replace('_', ' ').toUpperCase()} - Hold`;
                                workoutState.timeRemaining = 60;
                                runCooldownTimer();
                            }, 1000);
                        }
                    }
                }
            }, 1000);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startWorkout);
        document.getElementById('pauseBtn').addEventListener('click', pauseWorkout);
        document.getElementById('skipBtn').addEventListener('click', skipExercise);
        document.getElementById('completeBtn').addEventListener('click', completeWorkout);
        document.getElementById('resetBtn').addEventListener('click', resetTimers);

        document.getElementById('weekSelector').addEventListener('change', (e) => {
            workoutState.currentWeek = parseInt(e.target.value);
            updateUI();
        });

        // Navigation tabs
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                if (!workoutState.isRunning) {
                    switchToSection(tab.dataset.section);
                }
            });
        });

        // Finisher selection
        document.querySelectorAll('[data-exercise^="finisher_"]').forEach(card => {
            card.addEventListener('click', () => {
                if (workoutState.phase === 'circuit-complete' || (workoutState.phase === 'finisher' && !workoutState.isRunning)) {
                    const exerciseId = card.dataset.exercise;
                    sequences.finisher = [exerciseId];
                    
                    workoutState.isRunning = true;
                    workoutState.globalStartTime = Date.now();
                    workoutState.globalTimer = setInterval(updateGlobalTimer, 1000);
                    
                    document.getElementById('startBtn').classList.add('hidden');
                    document.getElementById('pauseBtn').classList.remove('hidden');
                    document.getElementById('skipBtn').classList.remove('hidden');
                    document.getElementById('completeBtn').classList.remove('hidden');
                    
                    startFinisher(exerciseId);
                }
            });
        });

        // Progress History Functions
        function showProgressHistory() {
            document.getElementById('progressModal').classList.remove('hidden');
            document.getElementById('summaryModal').classList.add('hidden');
        }

        function closeProgressHistory() {
            document.getElementById('progressModal').classList.add('hidden');
        }

        function loadWorkoutFiles(files) {
            const filePromises = Array.from(files).map(file => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            let data;
                            if (file.name.endsWith('.json')) {
                                data = JSON.parse(e.target.result);
                            } else {
                                // Handle legacy text files or try to parse as JSON
                                try {
                                    data = JSON.parse(e.target.result);
                                } catch {
                                    // Skip non-JSON files
                                    resolve(null);
                                    return;
                                }
                            }
                            
                            // Validate data structure
                            if (data.type === 'ProgressiveWorkout' && data.totalReps !== undefined) {
                                resolve(data);
                            } else {
                                resolve(null);
                            }
                        } catch (error) {
                            resolve(null);
                        }
                    };
                    reader.onerror = () => resolve(null);
                    reader.readAsText(file);
                });
            });

            Promise.all(filePromises).then(results => {
                const validWorkouts = results.filter(data => data !== null);
                if (validWorkouts.length === 0) {
                    showToast('‚ùå No valid workout files found');
                    return;
                }
                
                progressHistory = validWorkouts.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                displayProgressAnalysis();
                showToast(`üìä Loaded ${validWorkouts.length} workout${validWorkouts.length > 1 ? 's' : ''}!`);
            });
        }

        function displayProgressAnalysis() {
            const content = document.getElementById('progressContent');
            
            if (progressHistory.length === 0) {
                content.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        Upload your workout files to see your progress history and trends! üìà
                    </div>
                `;
                return;
            }

            // Calculate statistics
            const stats = calculateProgressStats();
            
            let html = `
                <!-- Overall Stats -->
                <div class="bg-gradient-to-r from-primary/10 to-orange-100 dark:from-primary/20 dark:to-orange-900/20 p-4 rounded-lg mb-4">
                    <h3 class="font-bold text-lg mb-3">üìà Overall Progress</h3>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-xl font-bold text-primary">${progressHistory.length}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Total Workouts</div>
                        </div>
                        <div>
                            <div class="text-xl font-bold text-primary">${stats.totalReps}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Total Reps</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Trends -->
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                    <h3 class="font-bold mb-3">üéØ Performance Trends</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>Average Reps/Workout:</span>
                            <span class="font-medium">${stats.avgReps}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Best Workout:</span>
                            <span class="font-medium">${stats.maxReps} reps</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Most Used Week:</span>
                            <span class="font-medium">Week ${stats.mostUsedWeek}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Avg Workout Time:</span>
                            <span class="font-medium">${stats.avgTime}</span>
                        </div>
                    </div>
                </div>

                <!-- Week Progress -->
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                    <h3 class="font-bold mb-3">üìä Progress by Week</h3>
                    <div class="space-y-2">`;
            
            [1, 2, 3, 4].forEach(week => {
                const weekWorkouts = progressHistory.filter(w => w.week === week);
                if (weekWorkouts.length > 0) {
                    const avgReps = Math.round(weekWorkouts.reduce((sum, w) => sum + w.totalReps, 0) / weekWorkouts.length);
                    const progress = weekWorkouts.length > 1 ? 
                        ((weekWorkouts[weekWorkouts.length - 1].totalReps - weekWorkouts[0].totalReps) / weekWorkouts[0].totalReps * 100) : 0;
                    
                    html += `
                        <div class="flex justify-between items-center p-2 rounded bg-white dark:bg-gray-600">
                            <span>Week ${week} (${weekWorkouts.length} workouts):</span>
                            <span class="font-medium">${avgReps} avg reps ${progress > 0 ? `(+${progress.toFixed(1)}%)` : ''}</span>
                        </div>
                    `;
                }
            });

            html += `
                    </div>
                </div>

                <!-- Recent Workouts -->
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-bold mb-3">üìÖ Recent Workouts</h3>
                    <div class="space-y-2 max-h-64 overflow-y-auto">`;
            
            progressHistory.slice(-10).reverse().forEach(workout => {
                const date = new Date(workout.timestamp).toLocaleDateString();
                html += `
                    <div class="flex justify-between items-center p-2 rounded bg-white dark:bg-gray-600">
                        <div>
                            <div class="font-medium">${date}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Week ${workout.week} ‚Ä¢ ${workout.totalTime}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-primary">${workout.totalReps}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">reps</div>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            content.innerHTML = html;
        }

        function calculateProgressStats() {
            if (progressHistory.length === 0) return {};
            
            const totalReps = progressHistory.reduce((sum, w) => sum + w.totalReps, 0);
            const avgReps = Math.round(totalReps / progressHistory.length);
            const maxReps = Math.max(...progressHistory.map(w => w.totalReps));
            
            // Calculate most used week
            const weekCounts = {};
            progressHistory.forEach(w => {
                weekCounts[w.week] = (weekCounts[w.week] || 0) + 1;
            });
            const mostUsedWeek = Object.keys(weekCounts).reduce((a, b) => weekCounts[a] > weekCounts[b] ? a : b);
            
            // Calculate average time (convert from various formats)
            const totalSeconds = progressHistory.reduce((sum, w) => {
                if (w.totalTimeSeconds) return sum + w.totalTimeSeconds;
                if (w.totalTime) {
                    const [mins, secs] = w.totalTime.split(':').map(Number);
                    return sum + (mins * 60) + secs;
                }
                return sum;
            }, 0);
            const avgTimeSeconds = Math.round(totalSeconds / progressHistory.length);
            const avgTime = formatTime(avgTimeSeconds);
            
            return {
                totalReps,
                avgReps,
                maxReps,
                mostUsedWeek,
                avgTime
            };
        }

        // Summary modal event listeners
        document.getElementById('saveProgressBtn').addEventListener('click', saveProgress);
        document.getElementById('copyProgressBtn').addEventListener('click', copyProgress);
        document.getElementById('shareFriendlyBtn').addEventListener('click', shareProgress);
        document.getElementById('viewProgressBtn').addEventListener('click', showProgressHistory);
        document.getElementById('closeSummaryBtn').addEventListener('click', closeSummary);
        document.getElementById('closeSummaryX').addEventListener('click', closeSummary);

        // Progress modal event listeners
        document.getElementById('closeProgressBtn').addEventListener('click', closeProgressHistory);
        document.getElementById('fileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                loadWorkoutFiles(e.target.files);
            }
        });

        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Create simple service worker inline
                const swCode = `
                const CACHE_NAME = 'progressive-workout-v1';
                const urlsToCache = [
                    '/',
                    '/index.html'
                ];

                self.addEventListener('install', (event) => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then((cache) => cache.addAll(urlsToCache))
                    );
                });

                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request)
                            .then((response) => {
                                return response || fetch(event.request);
                            }
                        )
                    );
                });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button if you want to add one later
            console.log('PWA install prompt ready');
        });

        // Lazy video loading for fast startup
        function loadVideo(placeholder, videoId) {
            const iframe = document.createElement('iframe');
            iframe.src = `https://www.youtube.com/embed/${videoId}`;
            iframe.frameBorder = '0';
            iframe.allowFullscreen = true;
            iframe.style.position = 'absolute';
            iframe.style.top = '0';
            iframe.style.left = '0';
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            
            // Create video container
            const container = document.createElement('div');
            container.className = 'video-container mb-3';
            container.appendChild(iframe);
            
            // Replace placeholder with video
            placeholder.parentNode.replaceChild(container, placeholder);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateUI();
            switchToSection('warmup');
        });
    </script>
</body>
</html>