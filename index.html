<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Progressive Workout</title>
    <style>
        :root {
            --primary-color: #FF7043; /* Vibrant Orange */
            --resume-color: #4caf50; /* Green for resume state */
            --text-color: #f5f5f5;
            --bg-color: #121212;
            --card-bg: #212121;
            --border-color: #424242;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem;
        }
        header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 1rem;
        }
        h1 {
            color: var(--primary-color);
            margin: 0;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .control-group label {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #bdbdbd;
        }
        .control-group select {
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-size: 1rem;
        }
        #start-workout-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
            width: 100%;
            margin-top: 1rem;
        }
        #start-workout-btn:hover {
            background-color: #F4511E;
        }
        #start-workout-btn:active {
            transform: scale(0.98);
        }
        #workout-area {
            display: none;
        }
        .timer-panel {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 2rem;
            border-left: 5px solid var(--primary-color);
            position: relative;
            transition: opacity 0.3s ease;
        }
        .timer-panel.paused {
            opacity: 0.7;
        }
        #timer-phase { font-size: 1.2rem; color: var(--primary-color); font-weight: bold; text-transform: uppercase; }
        #timer-exercise { font-size: 1.8rem; margin: 0.5rem 0; }
        #timer-countdown { font-size: 5rem; font-weight: bold; color: var(--primary-color); margin: 1rem 0; }
        #timer-next-up { font-size: 1rem; color: #bdbdbd; }

        #pause-resume-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: white;
            background-color: var(--primary-color);
            transition: background-color 0.3s;
        }

        .workout-section { margin-bottom: 2rem; }
        .workout-section h2 {
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .exercise-card {
            background-color: #2a2a2a;
            border: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .exercise-card.active {
            border-left: 5px solid var(--primary-color);
            transform: scale(1.02);
            background-color: #333;
        }
        .exercise-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .exercise-header h3 { margin: 0; }
        .exercise-header a { color: var(--primary-color); text-decoration: none; font-weight: bold; }
        .progress-tracker { margin-top: 0.5rem; display: flex; gap: 0.5rem; align-items: center; }
        .progress-tracker input { width: 70px; padding: 0.25rem; background-color: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 4px; }
        .progress-tracker button { font-size: 0.8rem; padding: 0.25rem 0.5rem; }

        #workout-complete { text-align: center; padding: 2rem; background-color: var(--card-bg); border-radius: 8px; display: none; }
        #workout-complete h2 { color: var(--primary-color); }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Progressive Bodyweight Protocol</h1>
            <p>Select your week and finisher, then begin.</p>
        </header>

        <div id="setup-panel">
            <div class="controls">
                <div class="control-group">
                    <label for="week-select">Select Week</label>
                    <select id="week-select">
                        <option value="1">Week 1 (45s work / 15s rest)</option>
                        <option value="2">Week 2 (50s work / 10s rest)</option>
                        <option value="3">Week 3 (55s work / 5s rest)</option>
                        <option value="4">Week 4 (60s work / 0s rest)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="finisher-select">Select Finisher</label>
                    <select id="finisher-select"></select>
                </div>
            </div>
            <button id="start-workout-btn">Start Workout</button>
        </div>

        <div id="workout-area">
            <div class="timer-panel" id="timer-panel">
                <button id="pause-resume-btn">Pause</button>
                <div id="timer-phase">GET READY</div>
                <div id="timer-exercise">Workout Starting Soon</div>
                <div id="timer-countdown">10</div>
                <div id="timer-next-up">Next Up: Jumping jacks</div>
            </div>
            <div id="full-workout-plan"></div>
        </div>

        <div id="workout-complete">
            <h2>Workout Complete!</h2>
            <p>Incredible effort! Your progress has been saved. See you next time.</p>
            <button onclick="location.reload()">Start Over</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        function getYouTubeID(url) {
            const arr = url.split(/(vi\/|v%3D|v=|\/v\/|youtu\.be\/|\/embed\/)/);
            return undefined !== arr[2] ? arr[2].split(/[?&]/)[0] : url;
        }

        const workoutPlan = {
            warmUp: [ { name: "Jumping jacks", url: "https://www.youtube.com/watch?v=Q4QnlZs9PqI" }, { name: "Arm swings & openers", url: "https://www.youtube.com/watch?v=7XctvtQxcpE" }, { name: "Bodyweight good mornings", url: "https://www.youtube.com/watch?v=Kdeq15AvUVU" }, { name: "Alternating reverse lunge + reach", url: "https://www.youtube.com/watch?v=Lvqm1kmYb6k" }, { name: "Inchworm to cobra", url: "https://www.youtube.com/watch?v=dtJq5pau5dY" }, ],
            mainCircuit: [ { name: "Handstand push-up (HSPU) / Pike push-up", url: "https://youtu.be/qbRbM6d5ddM" }, { name: "Split-squat iso hold (L)", url: "https://www.youtube.com/watch?v=n-C0T-JQeUU" }, { name: "Split-squat iso hold (R)", url: "https://www.youtube.com/watch?v=n-C0T-JQeUU" }, { name: "Levitation squat", url: "https://www.youtube.com/watch?v=EHocz1P-0iQ" }, { name: "Rotational push-up", url: "https://youtu.be/z9g54-vLd4A" }, { name: "Hip thrust", url: "https://www.youtube.com/watch?v=SEdqd1n0cvg" }, { name: "Cobra triceps extension", url: "https://youtu.be/AWedsdxUa7w" }, { name: "Reverse iron-cross", url: "https://youtu.be/59F3EtPYmWU" }, { name: "Heel touch crunch", url: "https://youtu.be/9bR-elyolBQ" }, { name: "Star plank", url: "https://youtu.be/a3hfwl9Sidc" }, ],
            finishers: [ { name: "Burpees", url: "https://www.youtube.com/watch?v=TU8QYVW0gDU" }, { name: "Mountain-climber sprints", url: "https://www.youtube.com/watch?v=nmwgirgXLYM" }, { name: "High-knee run in place", url: "https://www.youtube.com/watch?v=OAJ_J3EZkdY" }, ],
            coolDown: [ { name: "Child’s pose → cobra stretch", url: "https://youtu.be/4xPXuE0z19Y" }, { name: "Couch stretch", url: "https://youtu.be/Fg-lwNBzVV8" }, { name: "Doorway pec stretch", url: "https://youtu.be/B9uY01NoqBg" }, ]
        };

        const weeklyProgression = { 1: { work: 45, rest: 15 }, 2: { work: 50, rest: 10 }, 3: { work: 55, rest: 5 }, 4: { work: 60, rest: 0 }, };

        // --- DOM ELEMENTS ---
        const setupPanel = document.getElementById('setup-panel');
        const weekSelect = document.getElementById('week-select');
        const finisherSelect = document.getElementById('finisher-select');
        const startBtn = document.getElementById('start-workout-btn');
        const workoutArea = document.getElementById('workout-area');
        const timerPanel = document.getElementById('timer-panel');
        const timerPhase = document.getElementById('timer-phase');
        const timerExercise = document.getElementById('timer-exercise');
        const timerCountdown = document.getElementById('timer-countdown');
        const timerNextUp = document.getElementById('timer-next-up');
        const pauseResumeBtn = document.getElementById('pause-resume-btn');
        const fullWorkoutPlanDiv = document.getElementById('full-workout-plan');
        const workoutCompletePanel = document.getElementById('workout-complete');

        // --- STATE & AUDIO ---
        let masterTimerInterval;
        let workoutQueue = [];
        let isPaused = false;
        let currentItemTimeLeft;
        let audioCtx;

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            workoutPlan.finishers.forEach(f => {
                const option = document.createElement('option');
                option.value = f.name;
                option.textContent = f.name;
                finisherSelect.appendChild(option);
            });

            const savedWeek = localStorage.getItem('savedWeek') || '1';
            const savedFinisher = localStorage.getItem('savedFinisher') || workoutPlan.finishers[0].name;
            weekSelect.value = savedWeek;
            finisherSelect.value = savedFinisher;

            displayFullPlan();

            weekSelect.addEventListener('change', () => localStorage.setItem('savedWeek', weekSelect.value));
            finisherSelect.addEventListener('change', () => localStorage.setItem('savedFinisher', finisherSelect.value));
            startBtn.addEventListener('click', startWorkout);
            pauseResumeBtn.addEventListener('click', togglePause);
        });

        // --- AUDIO FUNCTION ---
        function playBuzzer() {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.15);
        }

        // --- UI FUNCTIONS ---
        function displayFullPlan() {
            fullWorkoutPlanDiv.innerHTML = `
                <div class="workout-section"><h2>Dynamic Warm Up (30s each, no rest)</h2>${workoutPlan.warmUp.map(ex => createExerciseCard(ex, false)).join('')}</div>
                <div class="workout-section"><h2>Main Circuit (3 Rounds)</h2>${workoutPlan.mainCircuit.map(ex => createExerciseCard(ex, true)).join('')}</div>
                <div class="workout-section"><h2>Finisher (10 Rounds, 20s on / 10s off)</h2>${workoutPlan.finishers.map(ex => createExerciseCard(ex, false)).join('')}</div>
                <div class="workout-section"><h2>Cool Down (60s hold each)</h2>${workoutPlan.coolDown.map(ex => createExerciseCard(ex, false)).join('')}</div>
            `;
            addLogButtonListeners();
        }

        function createExerciseCard(exercise, includeTracker) {
            const videoId = getYouTubeID(exercise.url);
            const videoLink = `https://www.youtube.com/watch?v=${videoId}`;
            let trackerHtml = '';
            if (includeTracker) {
                const storageKey = `log-${exercise.name}`;
                const lastLog = localStorage.getItem(storageKey) || "N/A";
                trackerHtml = `<div class="progress-tracker"><input type="text" placeholder="Reps" id="log-${videoId}"><button data-key="${storageKey}" data-input-id="log-${videoId}">Log</button><small>Last: ${lastLog}</small></div>`;
            }
            return `<div class="exercise-card" id="card-${videoId}"><div class="exercise-header"><h3>${exercise.name}</h3><a href="${videoLink}" target="_blank" rel="noopener noreferrer">Video Guide</a></div>${trackerHtml}</div>`;
        }

        function addLogButtonListeners() {
            document.querySelectorAll('.progress-tracker button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const key = e.target.dataset.key;
                    const inputId = e.target.dataset.inputId;
                    const value = document.getElementById(inputId).value;
                    if (value) {
                        localStorage.setItem(key, value);
                        e.target.closest('.progress-tracker').querySelector('small').textContent = `Last: ${value}`;
                        e.target.textContent = '✓';
                    }
                });
            });
        }

        function updateTimerDisplay(phase, exercise, time, nextUp) {
            timerPhase.textContent = phase;
            timerExercise.textContent = exercise;
            timerCountdown.textContent = time;
            timerNextUp.textContent = nextUp ? `Next Up: ${nextUp}` : '';

            document.querySelectorAll('.exercise-card').forEach(c => c.classList.remove('active'));
            if (exercise) {
                const videoId = getYouTubeID(workoutPlan.warmUp.find(e => e.name === exercise)?.url || workoutPlan.mainCircuit.find(e => e.name === exercise)?.url || workoutPlan.finishers.find(e => e.name === exercise)?.url || workoutPlan.coolDown.find(e => e.name === exercise)?.url || '');
                const activeCard = document.getElementById(`card-${videoId}`);
                if (activeCard) {
                    activeCard.classList.add('active');
                }
            }
        }

        // --- WORKOUT LOGIC ---
        function startWorkout() {
            // Initialize AudioContext on user interaction
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            setupPanel.style.display = 'none';
            workoutArea.style.display = 'block';
            buildWorkoutQueue();
            runItemFromQueue();
            masterTimerInterval = setInterval(masterTick, 1000);
        }

        function masterTick() {
            if (isPaused) return;
            if (currentItemTimeLeft === undefined) return;

            if (currentItemTimeLeft > 0) {
                currentItemTimeLeft--;
                timerCountdown.textContent = currentItemTimeLeft;
            }

            if (currentItemTimeLeft <= 0) {
                playBuzzer();
                runItemFromQueue();
            }
        }

        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                pauseResumeBtn.textContent = 'Resume';
                pauseResumeBtn.style.backgroundColor = 'var(--resume-color)';
                timerPanel.classList.add('paused');
            } else {
                if (audioCtx.state === 'suspended') { audioCtx.resume(); } // Resume audio context if it was suspended
                pauseResumeBtn.textContent = 'Pause';
                pauseResumeBtn.style.backgroundColor = 'var(--primary-color)';
                timerPanel.classList.remove('paused');
            }
        }

        function buildWorkoutQueue() {
            const selectedWeek = weekSelect.value;
            const { work, rest } = weeklyProgression[selectedWeek];
            const selectedFinisherName = finisherSelect.value;
            const selectedFinisher = workoutPlan.finishers.find(f => f.name === selectedFinisherName);
            workoutQueue = [];
            workoutQueue.push({ type: 'PREP', duration: 10, phase: 'GET READY', exercise: 'Workout Starting Soon', next: workoutPlan.warmUp[0].name });
            workoutPlan.warmUp.forEach((ex, i) => { workoutQueue.push({ type: 'WORK', duration: 30, phase: 'WARM-UP', exercise: ex.name, next: workoutPlan.warmUp[i + 1]?.name || workoutPlan.mainCircuit[0].name }); });
            for (let round = 1; round <= 3; round++) {
                workoutQueue.push({ type: 'REST', duration: 60, phase: `PREP FOR ROUND ${round}`, exercise: 'Get Ready!', next: workoutPlan.mainCircuit[0].name });
                workoutPlan.mainCircuit.forEach((ex, i) => {
                    workoutQueue.push({ type: 'WORK', duration: work, phase: `CIRCUIT - ROUND ${round}`, exercise: ex.name, next: workoutPlan.mainCircuit[i + 1]?.name || (round < 3 ? 'Round Rest' : selectedFinisher.name) });
                    if (rest > 0 && i < workoutPlan.mainCircuit.length - 1) { workoutQueue.push({ type: 'REST', duration: rest, phase: 'REST', exercise: 'Rest', next: workoutPlan.mainCircuit[i + 1].name }); }
                });
            }
            workoutQueue.push({ type: 'PREP', duration: 10, phase: 'PREP FOR FINISHER', exercise: 'Get Ready!', next: selectedFinisher.name });
            for (let round = 1; round <= 10; round++) {
                workoutQueue.push({ type: 'WORK', duration: 20, phase: `FINISHER - ROUND ${round}`, exercise: selectedFinisher.name, next: 'Rest' });
                if (round < 10) { workoutQueue.push({ type: 'REST', duration: 10, phase: 'REST', exercise: 'Rest', next: selectedFinisher.name }); }
            }
            workoutQueue.push({ type: 'REST', duration: 15, phase: 'COOL DOWN', exercise: 'Great Job! Time to cool down.', next: workoutPlan.coolDown[0].name });
            workoutPlan.coolDown.forEach((ex, i) => { workoutQueue.push({ type: 'WORK', duration: 60, phase: 'COOL DOWN', exercise: ex.name, next: workoutPlan.coolDown[i + 1]?.name || 'Workout Complete!' }); });
        }

        function runItemFromQueue() {
            if (workoutQueue.length === 0) {
                clearInterval(masterTimerInterval);
                workoutArea.style.display = 'none';
                workoutCompletePanel.style.display = 'block';
                return;
            }
            const item = workoutQueue.shift();
            currentItemTimeLeft = item.duration;
            updateTimerDisplay(item.phase, item.exercise, item.duration, item.next);
        }

    </script>
</body>
</html>
